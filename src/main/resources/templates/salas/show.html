<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  xmlns:sd="http://www.thymeleaf.org/spring-data" layout:decorate="~{admin/template_admin}">

<body>

<!-- Todo el contenido dinámico debe ir DENTRO del fragmento 'contenido' -->
<div layout:fragment="contenido">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-primary">Listado de Salas</h2>
    <a th:href="@{/salas/create}" class="btn btn-primary px-4">
      <i class="bi bi-plus-lg"></i> Nueva Sala
    </a>
  </div>

  <!-- ========================================== -->
  <!-- BLOQUE DE MENSAJES (Movido DENTRO del fragmento) -->
  <!-- ========================================== -->

  <!-- Mensaje de Éxito -->
  <div th:if="${msgExito}" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="bi bi-check-circle-fill"></i> <span th:text="${msgExito}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <!-- Mensaje de Error (Integridad o Lógica) -->
  <div th:if="${msgError}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="bi bi-exclamation-triangle-fill"></i> <span th:text="${msgError}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

  <!-- Mensaje de Error General (Fallback) -->
  <div th:if="${mensajeError}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <span th:text="${mensajeError}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  <!-- ========================================== -->

  <div class="card shadow">
    <div class="card-body">

      <!-- Formulario de Búsqueda -->
      <form th:action="@{/salas}" method="get" class="my-3">
        <div class="row">
          <div class="col-md-6 col-lg-4">
            <div class="input-group">
              <input type="search" name="nombres" class="form-control"
                     placeholder="Buscar sala por nombre" th:value="${param.nombres}">
              <button class="btn btn-primary" type="submit">
                <i class="bi bi-search"></i> Buscar
              </button>
            </div>
          </div>
        </div>
      </form>

      <!-- Estado Vacío -->
      <div th:if="${salas.totalElements == 0}" class="text-center py-4">
        <p class="text-muted mb-2">No hay salas registradas todavía.</p>
        <a th:href="@{/salas/create}" class="btn btn-primary">
          Crear primera sala
        </a>
      </div>

      <!-- Tabla de Resultados -->
      <div class="table-responsive">
        <table th:if="${salas.totalElements > 0}" class="table table-striped table-hover text-center align-middle">
          <thead class="table-dark">
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Capacidad</th>
            <th>Estado</th>
            <th>Acciones</th>
          </tr>
          </thead>

          <tbody>
          <tr th:each="s : ${salas}">
            <td th:text="${s.id}"></td>
            <td th:text="${s.nombres}"></td>
            <td th:text="${s.capacidad} + ' personas'"></td>

            <td>
              <!-- Badge condicional según el estado (Ajusta 'ACTIVO' según tu Enum/BD) -->
              <span class="badge rounded-pill"
                    th:classappend="${s.estado.toString() == 'ACTIVO' || s.estado.toString() == 'ACTIVA'} ? 'bg-success' : 'bg-secondary'">
                                        <span th:text="${s.estado}"></span>
                                    </span>
            </td>

            <td>
              <!-- Botón Editar con Texto -->
              <a th:href="@{'/salas/edit/' + ${s.id}}" class="btn btn-warning btn-sm me-1" title="Editar">
                <i class="bi bi-pencil"></i> Editar
              </a>

              <!-- Formulario Eliminar con Texto -->
              <form th:action="@{'/salas/delete/' + ${s.id}}" method="post" style="display:inline;">
                <button type="submit" class="btn btn-danger btn-sm" title="Eliminar"
                        onclick="return confirm('¿Estás seguro de eliminar esta sala?')">
                  <i class="bi bi-trash"></i> Eliminar
                </button>
              </form>
            </td>
          </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación (Usando el dialecto SD si lo tienes configurado, o botones simples) -->
      <div class="row mt-3" th:if="${salas.totalElements > 0}">
        <div class="col-sm-6 text-muted">
          <!-- Resumen de paginación -->
          <div sd:pagination-summary="">Mostrando resultados</div>
        </div>
        <div class="col-sm-6">
          <nav class="float-end">
            <!-- Controles de paginación -->
            <ul class="pagination" sd:pagination-split="7" sd:pagination="full">
              <li class="disabled"><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
              <li class="active"><a href="#">1 <span class="sr-only">(current)</span></a></li>
            </ul>
          </nav>
        </div>
      </div>

    </div>
  </div>
</div>

</body>
</html>